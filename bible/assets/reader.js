!function(){void 0===window.android&&(window.android={setVerse:function(e){console.log("android.setVerse: "+e)},setCopyText:function(e){console.log("android.setCopyText: "+e)},showAnnotation:function(e,t){console.log("android.showAnnotation: "+e+", "+t)},showNote:function(e){console.log("android.showNote: "+e)},setTop:function(e){console.log("android.setTop: "+e)},onLoaded:function(){console.log("android.onLoaded")}});var l,s,c,d=window.android,u="selection",m="-",f="(?:^|\\s)",p="";function g(e){var t=[];function n(e,t,n,o){var r=e.querySelectorAll(n);Array.prototype.forEach.call(r,function(e){o&&!S(e,o,!1)||t.push(e)})}return n(e=e||document,t,".chapternum"),n(e,t,"sup.versenum"),0==t.length&&n(e,t,"sup",s),t}function N(e){return S(e,"chapternum")?["1"]:e.textContent.trim().split(m)}function n(){var e,t=function(e){var t,n,o,r,i,a,l,s,c,d=p,u=p,f=NaN;for(o=document.createElement("div"),n=(r=document.querySelectorAll(e)).length,t=0;t<n;++t)d+=" "+r.item(t).innerHTML;for(o.innerHTML=d,n=(i=g(o)).length,t=0;t<n;++t)if(l=N(i[t]),s=parseInt(l[0].trim()),!isNaN(s))for(i[t].parentNode.removeChild(i[t]),(c=1<l.length?parseInt(l[1].trim()):NaN)&&!isNaN(c)||(c=s),a=s;a<=c;++a)isNaN(f)?u+=a:a==f||(a-f==1?u.endsWith(m)||(u+=m):(u.endsWith(m)&&(u+=f),u+=",",u+=a)),f=a;function h(e){var t=o.querySelectorAll(e);Array.prototype.forEach.call(t,function(e){e.parentNode.removeChild(e)})}return u.endsWith(m)&&!isNaN(f)&&(u+=f),h(".notelink"),h(".footnote"),h(".crossreference"),{verse:u,text:o.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p).trim()}}("."+u);t.text?(e=document.querySelectorAll(".highlight."+u).length,d.setCopyText(p+e+"\n"+t.verse+"\n"+t.text)):d.setCopyText(p)}function a(e){var r,t=e.className;r=!S(e,u),t.match(/\S+/g).forEach(function(e){var t,n,o;if(s&&-1!=e.indexOf(s))for(t=(o=document.getElementsByClassName(e)).length-1;-1<t;--t)"SUP"!=(n=o.item(t)).nodeName&&(r?b(n,u):C(n,u))}),n()}function h(e){var t,n,o,r,i,a;return(o=e.getBoundingClientRect()).width||o.height?(r=e.ownerDocument,n=null!=(a=i=r)&&a===a.window?i:9===i.nodeType&&i.defaultView,t=r.documentElement,Math.round(o.top+n.pageYOffset-t.clientTop)):Math.round(o.top)}function w(e,n){var t=document.querySelectorAll(e);Array.prototype.forEach.call(t,function(e){var t=e.getAttribute("value")||e.getAttribute("data-link");e.innerHTML=t?n?t.replace(/^.*?(<a.*?>).*?(<\/a>).*$/g,"$1"+n+"$2"):t:n})}function v(e){var t,n,o;if(window.search){for(e=null==e?"highlight":e.trim(),t=(o=document.getElementsByClassName(e)).length-1;-1<t;--t)(n=o.item(t)).className.trim()==e&&1==n.childNodes.length&&3==n.firstChild.nodeType?n.parentNode.replaceChild(n.firstChild,n):C(n,e);window.search=p,document.normalize()}}function y(e){var t,n,o,r,i=s+c+e,a=document.getElementsByClassName(i);if(a.length)return a;if("v"==i[0])for(n=["a","b","c"],t=0;t<3&&!(a=document.getElementsByClassName(i+n[t])).length;++t);else{for(r=new RegExp(f+i+"-\\S+"),l||(l=document.querySelectorAll(".text")),t=0;t<l.length&&!(o=l.item(t).className.match(r));++t);t!=l.length&&(a=document.getElementsByClassName(o[0]))}return a.length||e<2?a:y(e-1)}function x(e,t,n){var o,r,i;if(e)for(o=(i=y(e)).length-1;-1<o;--o)"SUP"!=(r=i.item(o)).nodeName&&(!1===t?C(r,n):b(r,n))}function b(e,t){e&&(e.className?S(e,t)||(e.className+=" "+t):e.className=t)}function S(e,t,n){var o;return!(!e||!e.className)&&(o=!1===n?new RegExp(f+t):new RegExp(f+t+"(?!\\S)"),null!=e.className.match(o))}function C(e,t){var n;e&&e.className&&(n=new RegExp(f+t+"(?!\\S)"),e.className.match(n)&&(e.className=e.className.replace(n,p).trim()))}function A(){if(null==s||null==c){try{c=m,s=document.querySelector(".text").className.replace(/\s*text\s*/g,p).split(c).splice(0,2).join(c)}catch(e){}try{s&&-1!=s.indexOf(c)||(c="_",(s=document.querySelector("sup").className.split(c).splice(0,2).join(c))&&-1!=s.indexOf(c)||(c=s=p))}catch(e){}}}function E(e,r,i){A(),s&&(void 0===i&&(i="highlight"),e.split(",").forEach(function(e){var t,n=e.split(m),o=parseInt(n[0]);if(2==n.length)for(t=parseInt(n[1]);o<=t;++o)x(o,r,i);else x(o,r,i)}))}function T(e,t){E(e,t,u)}String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{writable:!1,enumerable:!1,configurable:!1,value:function(e){return-1!==this.indexOf(e,this.length-e.length)}}),window.addEventListener("load",function(){var e,t,n,o,r='<span class="icon-footnote"></span>',i='<span class="icon-crossreference"></span>';A(),function(){var e,t,n,o,r,i,a=p;if(n=window.search){for(r=(o=document.body.innerHTML).toLowerCase(),i=n.toLowerCase();0<o.length&&(t=n,!((e=r.indexOf(i))<0));)o.lastIndexOf(">",e)>=o.lastIndexOf("<",e)&&(t='<span class="'+u+'">'+n+"</span>"),a+=o.substring(0,e)+t,o=o.substr(e+n.length),r=r.substr(e+n.length);a+=o,document.body.innerHTML=a}}(),e=window.highlighted,t=window.selected,n=window.notes,e&&E(e),t&&T(t),"[object Array]"==Object.prototype.toString.call(n)&&n.forEach(function(e){addnote(e)}),document.querySelector("#content").addEventListener("click",function(e){for(var t,n,o=e.target;o&&"BODY"!=o.nodeName;){if("IMG"==o.nodeName){if(t=o.getAttribute("data-note"))return e.preventDefault(),void d.showNote(t)}else if("A"==o.nodeName&&(S(o,"notelink")||o.parentNode&&"SUP"==o.parentNode.nodeName)){if(n=o.hash.replace("#",p))return e.preventDefault(),void d.showAnnotation(n,p)}else{if("A"==o.nodeName&&S(o,"bibleref"))return e.preventDefault(),void d.showAnnotation("cross",o.outerHTML);if("SPAN"==o.nodeName&&(S(o,"text")||S(o,s,!1))){v(u),a(o);break}}o=o.parentNode}}),(o=document.querySelector("#pb-demo"))&&(o.style.display="block"),w('a[id*="!f."]',r),w('a[id*="!x."]',i),w("sup.footnote",r),w("sup.crossreference",i),function r(e){setTimeout(function(){try{d.onLoaded(),!(o=window.verse)||parseInt(o)<=1||0<(n=y(o)).length&&(t=n.item(0),e=h(t)-5,d.setTop(e))}catch(e){console.log("error calling android.onLoaded"),console.log(e),r(500)}var e,t,n,o},e)}(100)}),window.getFirstVisibleVerse=function(e){var t,n,o,r,i,a=NaN;for(n=(r=g()).length,t=0;t<n;++t){if(e<=(i=h(r[t]))){o=isNaN(a)||Math.abs(a-e)>3*(i-e)?r[t]:r[t-1];break}a=i}o&&d.setVerse(parseInt(N(o)[0].trim()))},window.highlight=E,window.select=T,window.addNote=function(e,t){var n,o,r,i=y(e);if(i.length)for(n=0;n<i.length;++n)if(1==(r=i.item(n)).childNodes.length&&(r=r.querySelector("sup.versenum")||r.querySelector(".chapternum")||r.querySelector("sup"))&&(r=r.parentNode),r&&r.firstChild&&r.firstChild.nextSibling)return void(!1===t&&"IMG"==r.firstChild.nextSibling.nodeName?r.removeChild(r.firstChild.nextSibling):!1!==t&&"IMG"!=r.firstChild.nextSibling.nodeName&&((o=document.createElement("img")).setAttribute("class","note"),o.setAttribute("data-note",e),o.setAttribute("src","note.png"),r.insertBefore(o,r.firstChild.nextSibling)))}}();
