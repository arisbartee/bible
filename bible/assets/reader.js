!function(){function a(a){function b(a,b,c,d){var e=a.querySelectorAll(c);Array.prototype.forEach.call(e,function(a){(!d||t(a,d,!1))&&b.push(a)})}var c=[];return a=a||document,b(a,c,".chapternum"),b(a,c,"sup.versenum"),0==c.length&&b(a,c,"sup",A),c}function b(b){var d,e,f,g,h,i=NaN;for(g=a(),e=g.length,d=0;e>d;++d){if(h=j(g[d]),h>=b){f=isNaN(i)||Math.abs(i-b)>3*(h-b)?g[d]:g[d-1];break}i=h}f&&C.setVerse(parseInt(c(f)[0].trim()))}function c(a){return t(a,"chapternum")?["1"]:a.textContent.trim().split("-")}function d(b){function d(a){var b=h.querySelectorAll(a);Array.prototype.forEach.call(b,function(a){a.parentNode.removeChild(a)})}var e,f,g,h,i,j,k,l,m,n,o="",p="",q=NaN;for(h=document.createElement("div"),i=document.querySelectorAll(b),f=i.length,e=0;f>e;++e)o+=" "+i.item(e).innerHTML;for(h.innerHTML=o,j=a(h),f=j.length,e=0;f>e;++e)if(l=c(j[e]),m=parseInt(l[0].trim()),!isNaN(m))for(j[e].parentNode.removeChild(j[e]),n=l.length>1?parseInt(l[1].trim()):NaN,(!n||isNaN(n))&&(n=m),k=m;n>=k;++k)isNaN(q)?p+=k:k==q||(k-q==1?p.endsWith("-")||(p+="-"):(p.endsWith("-")&&(p+=q),p+=",",p+=k)),q=k;return p.endsWith("-")&&!isNaN(q)&&(p+=q),d(".notelink"),d(".footnote"),d(".crossreference"),g=h.textContent.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").trim(),{verse:p,text:g}}function e(){var a,b=d(".selected");b.text?(a=document.querySelectorAll(".highlight.selected").length,C.setCopyText(""+a+"\n"+b.verse+"\n"+b.text)):C.setCopyText("")}function f(a){var b,c=a.className;b=!t(a,"selected"),c.match(/\S+/g).forEach(function(a){var c,d,e;if(A&&-1!=a.indexOf(A))for(e=document.getElementsByClassName(a),c=e.length-1;c>-1;--c)d=e.item(c),"SUP"!=d.nodeName&&(b?s(d,"selected"):u(d,"selected"))}),e()}function g(){var a,b,c,d,e,f,g="";if(c=window.search,!c)return!1;for(d=document.body.innerHTML,e=d.toLowerCase(),f=c.toLowerCase();d.length>0&&(b=c,a=e.indexOf(f),!(0>a));)d.lastIndexOf(">",a)>=d.lastIndexOf("<",a)&&(b='<span class="selected">'+c+"</span>"),g+=d.substring(0,a)+b,d=d.substr(a+c.length),e=e.substr(a+c.length);return g+=d,document.body.innerHTML=g,!0}function h(a){return null!=a&&a===a.window}function i(a){return h(a)?a:9===a.nodeType&&a.defaultView}function j(a){var b,c,d,e;return d=a.getBoundingClientRect(),d.width||d.height?(e=a.ownerDocument,c=i(e),b=e.documentElement,Math.round(d.top+c.pageYOffset-b.clientTop)):Math.round(d.top)}function k(){var a,b,c,d,e='<span class="icon-footnote"></span>',f='<span class="icon-crossreference"></span>';v(),g(),a=window.highlighted,b=window.selected,c=window.notes,a&&w(a),b&&x(b),"[object Array]"==Object.prototype.toString.call(c)&&c.forEach(function(a){addnote(a)}),p(),d=document.querySelector("#pb-demo"),d&&(d.style.display="block"),n('a[id*="!f."]',e),n('a[id*="!x."]',f),n("sup.footnote",e),n("sup.crossreference",f),l(100)}function l(a){setTimeout(function(){try{C.onLoaded(),m()}catch(a){console.log("error calling android.onLoaded"),console.log(a),l(500)}},a)}function m(){var a,b,c,d;d=window.verse,!d||parseInt(d)<=1||(c=q(d),c.length>0&&(b=c.item(0),a=j(b)-5,C.setTop(a)))}function n(a,b){var c=document.querySelectorAll(a);Array.prototype.forEach.call(c,function(a){var c=a.getAttribute("value")||a.getAttribute("data-link");c?b?a.innerHTML=c.replace(/^.*?(<a.*?>).*?(<\/a>).*$/g,"$1"+b+"$2"):a.innerHTML=c:a.innerHTML=b})}function o(a){var b,c,d,e;if(b=window.search){for(a=void 0==a?"highlight":a.trim(),e=document.getElementsByClassName(a),c=e.length-1;c>-1;--c)d=e.item(c),d.className.trim()==a&&1==d.childNodes.length&&3==d.firstChild.nodeType?d.parentNode.replaceChild(d.firstChild,d):u(d,a);window.search="",document.normalize()}}function p(){document.querySelector("#content").addEventListener("click",function(a){for(var b,c,d=a.target;d&&"BODY"!=d.nodeName;){if("IMG"==d.nodeName){if(b=d.getAttribute("data-note"))return a.preventDefault(),void C.showNote(b)}else if("A"==d.nodeName&&(t(d,"notelink")||d.parentNode&&"SUP"==d.parentNode.nodeName)){if(c=d.hash.replace("#",""))return a.preventDefault(),void C.showAnnotation(c,"")}else{if("A"==d.nodeName&&t(d,"bibleref"))return a.preventDefault(),void C.showAnnotation("cross",d.outerHTML);if("SPAN"==d.nodeName&&(t(d,"text")||t(d,A,!1))){o("selected"),f(d);break}}d=d.parentNode}})}function q(a){var b,c,d,e,f=A+B+a,g=document.getElementsByClassName(f);if(g.length)return g;if("v"==f[0])for(c=["a","b","c"],b=0;3>b&&(g=document.getElementsByClassName(f+c[b]),!g.length);++b);else{for(e=new RegExp("(?:^|\\s)"+f+"-\\S+"),z||(z=document.querySelectorAll(".text")),b=0;b<z.length&&!(d=z.item(b).className.match(e));++b);b!=z.length&&(g=document.getElementsByClassName(d[0]))}return g.length||2>a?g:q(a-1)}function r(a,b,c){var d,e,f;if(a)for(f=q(a),d=f.length-1;d>-1;--d)e=f.item(d),"SUP"!=e.nodeName&&(b===!1?u(e,c):s(e,c))}function s(a,b){a&&(a.className?t(a,b)||(a.className+=" "+b):a.className=b)}function t(a,b,c){var d;return a&&a.className?(d=c===!1?new RegExp("(?:^|\\s)"+b):new RegExp("(?:^|\\s)"+b+"(?!\\S)"),null!=a.className.match(d)):!1}function u(a,b){var c;a&&a.className&&(c=new RegExp("(?:^|\\s)"+b+"(?!\\S)"),a.className.match(c)&&(a.className=a.className.replace(c,"").trim()))}function v(){if(void 0==A||void 0==B){try{B="-",A=document.querySelector(".text").className.replace(/\s*text\s*/g,"").split(B).splice(0,2).join(B)}catch(a){}try{A&&-1!=A.indexOf(B)||(B="_",A=document.querySelector("sup").className.split(B).splice(0,2).join(B),A&&-1!=A.indexOf(B)||(A="",B=""))}catch(a){}}}function w(a,b,c){v(),A&&(void 0===c&&(c="highlight"),a.split(",").forEach(function(a){var d,e=a.split("-"),f=parseInt(e[0]);if(2==e.length)for(d=parseInt(e[1]);d>=f;++f)r(f,b,c);else r(f,b,c)}))}function x(a,b){w(a,b,"selected")}function y(a,b){var c,d,e,f=q(a);if(f.length)for(c=0;c<f.length;++c)if(e=f.item(c),1==e.childNodes.length&&(e=e.querySelector("sup.versenum")||e.querySelector(".chapternum")||e.querySelector("sup"),e&&(e=e.parentNode)),e&&e.firstChild&&e.firstChild.nextSibling)return void(b===!1&&"IMG"==e.firstChild.nextSibling.nodeName?e.removeChild(e.firstChild.nextSibling):b!==!1&&"IMG"!=e.firstChild.nextSibling.nodeName&&(d=document.createElement("img"),d.setAttribute("class","note"),d.setAttribute("data-note",a),d.setAttribute("src","note.png"),e.insertBefore(d,e.firstChild.nextSibling)))}"undefined"==typeof window.android&&(window.android={setVerse:function(a){console.log("android.setVerse: "+a)},setCopyText:function(a){console.log("android.setCopyText: "+a)},showAnnotation:function(a,b){console.log("android.showAnnotation: "+a+", "+b)},showNote:function(a){console.log("android.showNote: "+a)},setTop:function(a){console.log("android.setTop: "+a)},onLoaded:function(){console.log("android.onLoaded")}});var z,A,B,C=window.android;String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{writable:!1,enumerable:!1,configurable:!1,value:function(a){return-1!==this.indexOf(a,this.length-a.length)}}),window.addEventListener("load",k),window.getFirstVisibleVerse=b,window.highlight=w,window.select=x,window.addNote=y}();